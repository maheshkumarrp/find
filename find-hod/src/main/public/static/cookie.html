<form id="cookie">
    <div>
        Select initial database:
        <select name="dbselect">
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:philips_usa">philips_usa</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:achieversclub">achieversclub</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:default_index">default_index</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:philips_cn">philips_cn</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:meethue">meethue</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:philips_uk">philips_uk</option>
            <option value="b498d1af-eba1-4b59-ac0b-672abdeeab61:philips_nl">philips_nl</option>
        </select>
        <input name="databases" value="" size="100">
    </div>
    <div>
        Specify extra fieldtext
        <input name="fieldtext" value="" size="100">
    </div>
</form>

<script src="bower_components/jquery/jquery.js"></script>
<script>
    $(function(){
        function setCookie(name, val) {
            document.cookie = name + '=' + encodeURIComponent(val).replace(/[()]/g, function(a){return '%' + a.charCodeAt(0).toString(16)})  +'; expires='+(new Date(+(new Date()) + 365 * 86400e3)).toUTCString()+'; path=/';
        }

        function setDbCookie(){
            setCookie('indexes', $db.val());
        }

        function setFieldTextCookie() {
            setCookie('fieldtext', $fieldtext.val());
        }

        var $form = $('#cookie').submit(function(){
            setDbCookie();
            return false;
        });
        var $db = $form.find('input[name=databases]').keyup(function(){
            setDbCookie();
        });

        var $dbSelect = $form.find('select').change(function(){
            $db.val(this.value);
            setDbCookie()
        });

        var $fieldtext = $form.find('input[name=fieldtext]').keyup(function(){
            setFieldTextCookie();
        });

        $.each(document.cookie.split(';'), function(idx, str){
            var match = /^indexes=(.*)/.exec($.trim(str));
            if (match) {
                var db = decodeURIComponent(match[1]);
                $db.val(db);
                $dbSelect[0].value = db;
            }
            match = /^fieldtext=(.*)/.exec($.trim(str));
            if (match) {
                $fieldtext.val(decodeURIComponent(match[1]))
            }
        });


        $.ajax('../api/public/search/list-indexes').done(function(resp){
            var values = [];
            var curVal = $db.val();
            for (var ii = 0; ii < resp.length; ++ii) {
                var index = resp[ii];
                if (!index.public) {
                    var value = index.domain + ':' + index.name;
                    var selected = curVal === value ? ' selected' : '';
                    values.push('<option value="' + value+'"' + selected + '>'+index.name+'</option>');
                }
            }
            if (values.length) {
                values.sort();
                $dbSelect.html(values.join(''));

            }
        })
    })
</script>
